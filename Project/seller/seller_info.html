<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Personal Information</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <link rel="stylesheet" href="/public/css/bootstrap.min.css">
  <script src="/public/js/bootstrap.bundle.min.js"></script>
  <link rel="icon" type="image/x-icon" href="/public/img/logo-w.png">
  <style>
    /* .br {
            display: flex;
            margin-bottom: 15px;
        }

        input::placeholder {
            font-size: 25px;
        } */
  </style>
</head>

<body style="background-color: #f1f1f1;">
  <div style="background-color:#f5eecc;" class="d-flex">
    <div class="d-flex align-items-center"
      style="background:#4b2f7b ; border-radius: 0px 300px 300px 0px; width: 1300px; height: 120px; padding: 20px;">
      <img src="/public/img/logo-w.png" width="100px" alt="Logo">
      <div class="d-flex justify-content-between" style="margin-left: 65px;">
        <a href="/sellerhomepage" style="color:white; text-decoration:none; font-size: 20px; padding-left: 65px;">
          <i class="bi bi-house-door"></i> Homepage
        </a>
        <a href="/add-trackingnum" style="color: white; text-decoration:none; font-size: 20px; padding-left: 65px;">
          <i class="bi bi-truck"></i> เลขพัสดุ
        </a>
        <a style="color: white; text-decoration:none; font-size: 20px; padding-left: 65px;" data-bs-toggle="modal"
          data-bs-target="#helpModal">
          <i class="bi bi-chat-dots"></i> Help
        </a>
      </div>
      <!-- pop up contect store -->
      <div class="modal fade" id="helpModal" tabindex="-1" aria-labelledby="helpModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content" style="background-color: #F3F3E3;">
            <div class="modal-header" style="background-color:#A9B489;">
              <h5 class="modal-title" id="helpModalLabel">ช่องทางการติดต่อ</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <p><strong>ID LINE:</strong> qwqwefs</p>
              <p><strong>IG:</strong> surety_sp</p>
              <p><strong>Facebook:</strong> klsdadj</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="d-flex align-items-center ms-auto" style="padding-right: 20px;">
      <button id="btnlogout" style="background: #B72323; border-radius: 13px; border-color: transparent; width: 150px;
            height: 46px; color: white;" onclick="location.replace('/login');">
        Log out
        <i class="bi bi-box-arrow-right" style="padding-left: 15px;"></i>
      </button>
    </div>
  </div>
  <!-- <h1 style="text-align: start; font-weight: bold; margin: 30px;">ประวัติส่วนตัว</h1> -->
  <div class="personalInfo">
    <div class="center">
      <img id="userProfile" style="height: 200px; width: 200px; margin-top: 20px; border-radius: 50%;"
        src="/public/img/fprofile.jpg">
      <input id="profileImageUpload" type="file" style="margin-top: 10px;" disabled>
    </div>
    <div style="margin-left: 450px;">
      <div class="row">
        <span style="width: 260px; font-weight: 700;">Name:</span>
        <input id="userName" style="padding:15px; flex-grow: 1; width:500px; border-radius: 25px; border:none;"
          disabled>
      </div>
      <div class="row">
        <span style="width: 260px; font-weight: 700;">Phone Number:</span>
        <input id="userPhonenum" style="padding:15px; flex-grow: 1; width:500px; border-radius: 25px; border:none;"
          disabled>
      </div>
      <div class="row">
        <span style="width: 260px; font-weight: 700;">Email:</span>
        <input id="userEmail" style="padding:15px; flex-grow: 1; width:500px; border-radius: 25px; border:none;"
          disabled>
      </div>
      <div class="row">
        <span style="width: 260px; font-weight: 700;">Bank Account Name:</span>
        <select id="userBankName" style="border-radius: 15px; border:none; padding:5px; width:500px;">
          <option value="กรุงเทพ">กรุงเทพ</option>
          <option value="กสิกรไทย">กสิกรไทย</option>
          <option value="กรุงไทย">กรุงไทย</option>
          <option value="กรุงศรีอยุธยา">กรุงศรีอยุธยา</option>
          <option value="เกียรตินาคิน">เกียรตินาคิน</option>
          <option value="ซีไอเอ็มบีไทย">ซีไอเอ็มบีไทย</option>
          <option value="ทหารไทย">ทหารไทย</option>
          <option value="ไทยพาณิชย์">ไทยพาณิชย์</option>
          <option value="ทิสโก้">ทิสโก้</option>
          <option value="ไทยเครดิตเพื่อรายย่อย">ไทยเครดิตเพื่อรายย่อย</option>
          <option value="ธนชาต">ธนชาต</option>
          <option value="ธนาคารพัฒนาวิสาหกิจขนาดกลางและขนาดย่อมแห่งประเทศไทย">
            ธนาคารพัฒนาวิสาหกิจขนาดกลางและขนาดย่อมแห่งประเทศไทย</option>
          <option value="ธนาคารเพื่อการเกษตรและสหกรณ์การเกษตร">ธนาคารเพื่อการเกษตรและสหกรณ์การเกษตร</option>
          <option value="ธนาคารเพื่อการส่งออกและนำเข้าแห่งประเทศไทย">ธนาคารเพื่อการส่งออกและนำเข้าแห่งประเทศไทย</option>
          <option value="ธนาคารออมสิน">ธนาคารออมสิน</option>
          <option value="ธนาคารอาคารสงเคราะห์">ธนาคารอาคารสงเคราะห์</option>
          <option value="ธนาคารอิสลามแห่งประเทศไทย">ธนาคารอิสลามแห่งประเทศไทย</option>
          <option value="ธนาคารแห่งประเทศจีน">ธนาคารแห่งประเทศจีน</option>
          <option value="ธนาคาร มิตซุย ทรัสต์ (ไทย)">ธนาคาร มิตซุย ทรัสต์ (ไทย)</option>
          <option value="ธนาคารฮ่องกงและเซี้ยงไฮ้แบงกิ้งคอร์ปอเรชั่นจำกัด">
            ธนาคารฮ่องกงและเซี้ยงไฮ้แบงกิ้งคอร์ปอเรชั่นจำกัด</option>
          <option value="ยูโอบี">ยูโอบี</option>
          <option value="แลนด์ แอนด์ เฮาส์">แลนด์ แอนด์ เฮาส์</option>
          <option value="สแตนดาร์ดชาร์เตอร์ด (ไทย)">สแตนดาร์ดชาร์เตอร์ด (ไทย)</option>
          <option value="ไอซีบีซี (ไทย)">ไอซีบีซี (ไทย)</option>
          <option value="Promptpay">Promptpay</option>
          <option value="TrueMoney Wallet">TrueMoney Wallet</option>
        </select>
      </div>
      <div class="row">
        <span style="width: 260px; font-weight: 700;">Bank Account Number:</span>
        <input id="userBankNum" style="padding:15px; flex-grow: 1; width:500px; border-radius: 25px; border:none;"
          disabled>
      </div>
      <div class="row">
        <span style="width: 260px; font-weight: 700;">Other Contact:</span>
        <input id="userContact" style="padding:15px; flex-grow: 1; width:500px; border-radius: 25px; border:none;"
          disabled>
      </div>
      <div class="center">
        <button onclick="enableEditing()"
          style="width: 300px; color:white; background-color: black; border-radius: 25px;">Edit</button>
        <button onclick="saveChanges()"
          style="width: 300px; color:white; background-color: green; border-radius: 25px; display: none;">Save</button>
      </div>
    </div>
  </div>

</body>

<script>
  const userId = window.location.pathname.split('/').pop(); // Extract userId from URL

  if (!userId) {
    console.error("User ID is not defined");
  }

  async function loadUserData() {
    try {
      const response = await fetch(`/sellerinfo/${userId}`);
      if (!response.ok) throw new Error("Failed to fetch user data");

      const user = await response.json();

      // Populate fields with user data
      document.getElementById('userProfile').src = `/public/img/${user.profile_img}`;
      document.getElementById('userName').value = `${user.first_name} ${user.last_name}`;
      document.getElementById('userPhonenum').value = user.phonenum;
      document.getElementById('userEmail').value = user.email;
      document.getElementById('userBankName').value = user.bank_ac_name;
      document.getElementById('userBankNum').value = user.bank_ac_num;
      document.getElementById('userContact').value = user.sacc_contact;
    } catch (error) {
      console.error("Error loading user data:", error);
    }
  }

  function enableEditing() {
    document.querySelectorAll('input, select').forEach(input => input.disabled = false);
    document.querySelector('#profileImageUpload').disabled = false;
    document.querySelector('button[onclick="saveChanges()"]').style.display = 'inline';
    document.querySelector('button[onclick="enableEditing()"]').style.display = 'none';
  }

  async function saveChanges() {
    const formData = new FormData();
    const profileImage = document.getElementById('profileImageUpload').files[0];
    if (profileImage) formData.append('profile_img', profileImage);

    // Collect values from the form
    formData.append('first_name', document.getElementById('userName').value.split(' ')[0]);
    formData.append('last_name', document.getElementById('userName').value.split(' ')[1] || '');
    formData.append('phonenum', document.getElementById('userPhonenum').value);
    formData.append('email', document.getElementById('userEmail').value);
    formData.append('bank_ac_name', document.getElementById('userBankName').value); // Dropdown value
    formData.append('bank_ac_num', document.getElementById('userBankNum').value);
    formData.append('sacc_contact', document.getElementById('userContact').value);

    try {
      const response = await fetch(`/updateSellerInfo/${userId}`, {
        method: 'POST',
        body: formData,
      });

      if (response.ok) {
        alert("Profile updated successfully!");
        loadUserData(); // Reload updated data
      } else {
        alert("Failed to update profile");
      }
    } catch (error) {
      console.error("Error saving profile:", error);
    }
  }

  // Load user data when the page loads
  loadUserData();
</script>


<style>
  .center {
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .row {
    display: flex;
    flex-direction: row;
  }

  .col {
    display: flex;
    flex-direction: column;
  }
</style>

</html>