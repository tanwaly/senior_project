<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Personal Information</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <link rel="stylesheet" href="/public/css/bootstrap.min.css">
  <script src="/public/js/bootstrap.bundle.min.js"></script>
  <link rel="icon" type="image/x-icon" href="/public/img/logo-w.png">
  <style>
    .br {
      display: flex;
      margin-bottom: 15px;
    }

    input::placeholder {
      font-size: 25px;
    }

    .form-control[type="text"] {
            background-color: #DCE8F5; /* สีเทา */
            color: #000; /* สีข้อความ */
            border: 1px solid #ccc; /* ขอบ */
            padding: 5px;
        }

    .form-control[type="text"]:focus {
            background-color: #DCE8F5; /* สีเทาอ่อนเมื่อคลิก */
            outline: none; /* เอาเส้นขอบ focus ออก */
        }
        
      select#userBankName {
  background-color: #DCE8F5 !important;
  border-radius: 15px !important;
}
  </style>
</head>

<body style="background-color: white;">
  <div style="background-color:#FEF3D0;" class="d-flex">
    <div class="d-flex align-items-center"
      style="background:#D46F95; border-radius: 0px 300px 300px 0px; width:auto; max-width: 1300px; height: 120px; padding: 20px;">
      <img src="/public/img/logo-w.png" width="100px" alt="Logo">
      <div class="d-flex justify-content-between" style="margin-left: 65px;">
        <a href="/sellerhomepage" style="color:white; text-decoration:none; font-size: 20px; padding-left: 65px;">
          <i class="bi bi-house-door"></i> Homepage
        </a>
        <a href="/add-trackingnum" style="color: white; text-decoration:none; font-size: 20px; padding-left: 65px;">
          <i class="bi bi-truck"></i> เลขพัสดุ
        </a>
        <a style="color: white; text-decoration:none; font-size: 20px; padding-left: 65px; padding-right: 165px;"
          data-bs-toggle="modal" data-bs-target="#helpModal">
          <i class="bi bi-chat-dots"></i> Help
        </a>
      </div>
      <!-- pop up contect store -->
      <div class="modal fade" id="helpModal" tabindex="-1" aria-labelledby="helpModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content" style="background-color: #F3F3E3;">
            <div class="modal-header" style="background-color:#D46F95;">
              <h5 class="modal-title" id="helpModalLabel" style="font-weight: 600; color: white;">
                ช่องทางการติดต่อ</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <p style="font-size: 18px;"><i class="bi bi-line" style="font-size: 25px; color: #06c755"></i><strong>
                  Line
                  :</strong> surety_offical</p>
              <p style="font-size: 18px;"><i class="bi bi-instagram" style="font-size: 25px; background: -webkit-linear-gradient(#f9ce34,#ee2a7b,#6228d7);
                    -webkit-background-clip: text;
                    -webkit-text-fill-color: transparent;"></i><strong> Instagram :</strong> surety_sp</p>
              <p style="font-size: 18px;"><i class="bi bi-facebook"
                  style="font-size: 25px; color: 	#1877F2"></i><strong> Facebook
                  :</strong> Surety</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="d-flex align-items-center ms-auto" style="padding-right: 20px;">
      <button id="btnlogout" style="background: #B72323; border-radius: 13px; border-color: transparent; width: 150px;
            height: 46px; color: white;" onclick="location.replace('/login');">
        Log out
        <i class="bi bi-box-arrow-right" style="padding-left: 15px;"></i>
      </button>
    </div>
  </div>

  <div class="personalInfo">
    <div class="center" style="flex-direction: column;">
      <img id="userProfile" style="height: 200px; width: 200px; margin-top: 20px; border-radius: 50%;" class="avatar"
        src="/public/img/fprofile.jpg">
      <!-- New button to upload profile image -->
      <button id="profileImageUploadButton"
        style="width: 200px; height: 40px; color:white; background-color: gray; border: none    ; border-radius: 25px; margin: 20px; display: none;"
        onclick="document.getElementById('profileImageUpload').click();">Edit profile picture</button>

      <!-- Hidden file input -->
      <input id="profileImageUpload" type="file" style="display: none; ">

    </div>
    <div style="margin-left: 400px; ">
      <div class="row" style="margin: 5px;">
        <span style="width: 260px; font-weight: 700;">ชื่อ:</span>
        <input type="text" class="form-control" id="userName" style="padding:10px; width: 500px; border-radius: 25px; border:none;"
          disabled>
      </div>
      <div class="row" style="margin: 5px;">
        <span style="width: 260px; font-weight: 700;">เบอร์โทรศัพท์:</span>
        <input type="text" class="form-control" id="userPhonenum"
          style="padding:10px; width:500px; border-radius: 25px; border:none;" disabled>
      </div>
      <div class="row" style="margin: 5px;">
        <span style="width: 260px; font-weight: 700;">Email:</span>
        <input type="text" class="form-control" id="userEmail" style="padding:10px; width:500px; border-radius: 25px; border:none;"
          disabled>
      </div>
      <div class="row" style="margin: 5px;">
        <span style="width: 260px; font-weight: 700;">ชื่อบัญชีธนาคาร:</span>
        <select  class="form-control" id="userBankName" disabled
          style="border-radius: 15px; border:none; padding:5px; width:500px; ">
          <option value="กรุงเทพ">กรุงเทพ</option>
          <option value="กสิกรไทย">กสิกรไทย</option>
          <option value="กรุงไทย">กรุงไทย</option>
          <option value="กรุงศรีอยุธยา">กรุงศรีอยุธยา</option>
          <option value="เกียรตินาคิน">เกียรตินาคิน</option>
          <option value="ซีไอเอ็มบีไทย">ซีไอเอ็มบีไทย</option>
          <option value="ทหารไทย">ทหารไทย</option>
          <option value="ไทยพาณิชย์">ไทยพาณิชย์</option>
          <option value="ทิสโก้">ทิสโก้</option>
          <option value="ไทยเครดิตเพื่อรายย่อย">ไทยเครดิตเพื่อรายย่อย</option>
          <option value="ธนชาต">ธนชาต</option>
          <option value="ธนาคารพัฒนาวิสาหกิจขนาดกลางและขนาดย่อมแห่งประเทศไทย">
            ธนาคารพัฒนาวิสาหกิจขนาดกลางและขนาดย่อมแห่งประเทศไทย</option>
          <option value="ธนาคารเพื่อการเกษตรและสหกรณ์การเกษตร">ธนาคารเพื่อการเกษตรและสหกรณ์การเกษตร</option>
          <option value="ธนาคารเพื่อการส่งออกและนำเข้าแห่งประเทศไทย">ธนาคารเพื่อการส่งออกและนำเข้าแห่งประเทศไทย</option>
          <option value="ธนาคารออมสิน">ธนาคารออมสิน</option>
          <option value="ธนาคารอาคารสงเคราะห์">ธนาคารอาคารสงเคราะห์</option>
          <option value="ธนาคารอิสลามแห่งประเทศไทย">ธนาคารอิสลามแห่งประเทศไทย</option>
          <option value="ธนาคารแห่งประเทศจีน">ธนาคารแห่งประเทศจีน</option>
          <option value="ธนาคาร มิตซุย ทรัสต์ (ไทย)">ธนาคาร มิตซุย ทรัสต์ (ไทย)</option>
          <option value="ธนาคารฮ่องกงและเซี้ยงไฮ้แบงกิ้งคอร์ปอเรชั่นจำกัด">
            ธนาคารฮ่องกงและเซี้ยงไฮ้แบงกิ้งคอร์ปอเรชั่นจำกัด</option>
          <option value="ยูโอบี">ยูโอบี</option>
          <option value="แลนด์ แอนด์ เฮาส์">แลนด์ แอนด์ เฮาส์</option>
          <option value="สแตนดาร์ดชาร์เตอร์ด (ไทย)">สแตนดาร์ดชาร์เตอร์ด (ไทย)</option>
          <option value="ไอซีบีซี (ไทย)">ไอซีบีซี (ไทย)</option>
          <option value="Promptpay">Promptpay</option>
          <option value="TrueMoney Wallet">TrueMoney Wallet</option>
        </select>
      </div>
      <div class="row" style="margin: 5px;">
        <span style="width: 260px; font-weight: 700;">เลขบัญชีธนาคาร:</span>
        <input type="text" class="form-control" id="userBankNum"
          style="padding:10px; width:500px; border-radius: 25px; border:none;" disabled>
      </div>
      <div class="row" style="margin: 5px;">
        <span style="width: 260px; font-weight: 700;">ช่องทางการติดต่ออื่น ๆ:</span>
        <input type="text" class="form-control" id="userContact"
          style="padding:10px; width:500px; border-radius: 25px; border:none;" disabled>
      </div>
    </div>
    <center>
      <div>
        <button onclick="enableEditing()"
          style="width: 300px; height: 40px; color:white; background-color: black; border-radius: 25px; margin: 20px;">Edit</button>
        <button onclick="saveChanges()"
          style="width: 300px; height: 40px; color:white; border: none; background-color: #70b249; border-radius: 25px; display: none; margin: 20px;">Save</button>
      </div>
    </center>
  </div>

</body>

</html>


<script>
  const userId = 'someSellerId'; // Replace with actual logic to get seller ID

  // Load user data into the form
  async function loadUserData() {
    try {
      const response = await fetch(`/getSellerData`);
      if (!response.ok) throw new Error("Failed to fetch user data");

      const user = await response.json();

      document.getElementById('userProfile').src = `/public/img/${user.profile_img || 'default-profile.png'}`;
      document.getElementById('userName').value = `${user.first_name} ${user.last_name}`;
      document.getElementById('userPhonenum').value = user.phonenum;
      document.getElementById('userEmail').value = user.email;
      document.getElementById('userBankName').value = user.bank_ac_name;
      document.getElementById('userBankNum').value = user.bank_ac_num;
      document.getElementById('userContact').value = user.sacc_contact;
    } catch (error) {
      console.error("Error loading user data:", error);
    }
  }



  // Handle profile image selection and display the selected image
  document.getElementById('profileImageUpload').addEventListener('change', function (event) {
    const reader = new FileReader();
    reader.onload = function (e) {
      document.getElementById('userProfile').src = e.target.result;
    };
    reader.readAsDataURL(event.target.files[0]);
  });


  // Save the updated user data
  async function saveChanges() {
    const formData = new FormData();
    const profileImage = document.getElementById('profileImageUpload').files[0];
    if (profileImage) formData.append('profile_img', profileImage);

    formData.append('first_name', document.getElementById('userName').value.split(' ')[0]);
    formData.append('last_name', document.getElementById('userName').value.split(' ')[1]);
    formData.append('phonenum', document.getElementById('userPhonenum').value);
    formData.append('email', document.getElementById('userEmail').value);
    formData.append('bank_ac_name', document.getElementById('userBankName').value);
    formData.append('bank_ac_num', document.getElementById('userBankNum').value);
    formData.append('sacc_contact', document.getElementById('userContact').value);

    try {
      const response = await fetch(`/updateSellerInfo/${userId}`, {
        method: 'POST',
        body: formData
      });

      if (!response.ok) throw new Error('Failed to save changes');
      alert('Changes saved successfully');

      // After saving, reload the user data and disable the fields
      loadUserData();

      // Disable editing mode
      disableEditing();
    } catch (error) {
      console.error("Error saving changes:", error);
    }
  }
  // Enable the fields for editing
  function enableEditing() {
    document.querySelectorAll('input, select').forEach(input => input.disabled = false);
    document.querySelector('#profileImageUploadButton').style.display = 'inline';
    document.querySelector('button[onclick="saveChanges()"]').style.display = 'inline';
    document.querySelector('button[onclick="enableEditing()"]').style.display = 'none';
  }

  // Disable editing and return to the original state
  function disableEditing() {
    document.querySelectorAll('input, select').forEach(input => input.disabled = true);
    document.querySelector('#profileImageUploadButton').style.display = 'none';
    document.querySelector('button[onclick="saveChanges()"]').style.display = 'none';
    document.querySelector('button[onclick="enableEditing()"]').style.display = 'inline';
  }


  // Initialize page with user data
  loadUserData();
</script>

<style>
  .center {
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .row {
    display: flex;
    flex-direction: row;
  }

  .col {
    display: flex;
    flex-direction: column;
  }

  .avatar {
    vertical-align: middle;
    width: 50px;
    height: 50px;
    border-radius: 50%;
  }
</style>