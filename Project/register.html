<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js"></script>
    <link rel="stylesheet" href="/public/css/bootstrap.min.css" />
    <script src="/public/js/bootstrap.bundle.min.js"></script>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/x-icon" href="/public/img/logo-w.png">
    <title>Register</title>
</head>

<body style="background: #b084a9">
    <div class="container">
        <h1>Register</h1>
        <center>
            <div class="toggle-switch">
                <input type="radio" id="customer" name="role" checked onclick="toggleForm()">
                <label for="customer" class="toggle-label">Customer</label>
                <input type="radio" id="seller" name="role" onclick="toggleForm()">
                <label for="seller" class="toggle-label">Seller</label>
                <div class="toggle-switch-button"></div>
            </div>
            <form id="registerForm" action="/register" method="POST">
                <!-- <input type="hidden" id="selectedRole" name="role" value="1"> -->
                <!-- Customer Form -->
                <div id="customerForm" style="display: block; width: 500px; margin-top: 20px;">
                    <p style="text-align: start; color: #6E6E6E; margin-bottom: -1px;">ชื่อ</p>
                    <input type="text" class="form-control" name="first_name"
                        style="background-color: #E9E9E9; border-radius: 10px; border: none; height: 50px; margin-bottom: 15px;">
                    <!--  -->
                    <p style="text-align: start; color: #6E6E6E; margin-bottom: -1px;">นามสกุล</p>
                    <input type="text" class="form-control" name="last_name"
                        style="background-color: #E9E9E9; border-radius: 10px; border: none; height: 50px; margin-bottom: 15px;">
                    <!--  -->
                    <p style="text-align: start; color: #6E6E6E; margin-bottom: -1px;">เบอร์โทร</p>
                    <input type="tel" class="form-control" name="phonenum"
                        style="background-color: #E9E9E9; border-radius: 10px; border: none; height: 50px; margin-bottom: 15px;">
                    <!--  -->
                    <p style="text-align: start; color: #6E6E6E; margin-bottom: -1px;">Email</p>
                    <input type="text" class="form-control" name="email"
                        style="background-color: #E9E9E9; border-radius: 10px; border: none; height: 50px; margin-bottom: 15px;">
                    <p style="text-align: start; color: #6E6E6E; margin-bottom: -1px;">password</p>
                    <input type="password" class="form-control" name="password"
                        style="background-color: #E9E9E9; border-radius: 10px; border: none; height: 50px; margin-bottom: 15px;">
                    <p style="text-align: start; color: #6E6E6E; margin-bottom: -1px;">confirm password</p>
                    <input type="password" class="form-control" name="confirm-pass"
                        style="background-color: #E9E9E9; border-radius: 10px; border: none; height: 50px; margin-bottom: 15px;">

                </div>

                <!-- Seller Form -->
                <div id="sellerForm" style="display: none; width: 500px; margin-top: 20px;">
                    <p style="text-align: start; color: #6E6E6E; margin-bottom: -1px;">ธนาคาร</p>
                    <select id="bank" name="bank_ac_name"
                        style="padding-left: 10px; width: 500px; height: 50px; background-color: #E9E9E9; font-size: 15px; border-radius: 8px; border: none; color: #515050; margin-bottom: 15px;">
                        <option option value="" disabled selected>กรุณาเลือกธนาคาร</option>
                        <option value="1">กรุงเทพ</option>
                        <option value="2">กสิกรไทย</option>
                        <option value="3">กรุงไทย</option>
                        <option value="4">กรุงศรีอยุธยา</option>
                        <option value="5">เกียรตินาคิน</option>
                        <option value="6">ซีไอเอ็มบีไทย</option>
                        <option value="7">ทหารไทย</option>
                        <option value="8">ไทยพาณิชย์</option>
                        <option value="9">ทิสโก้</option>
                        <option value="10">ไทยเครดิตเพื่อรายย่อย</option>
                        <option value="11">ธนชาต</option>
                        <option value="12">ธนาคารพัฒนาวิสาหกิจขนาดกลางและขนาดย่อมแห่งประเทศไทย</option>
                        <option value="13">ธนาคารเพื่อการเกษตรและสหกรณ์การเกษตร</option>
                        <option value="14">ธนาคารเพื่อการส่งออกและนำเข้าแห่งประเทศไทย</option>
                        <option value="15">ธนาคารออมสิน</option>
                        <option value="16">ธนาคารอาคารสงเคราะห์</option>
                        <option value="17">ธนาคารอิสลามแห่งประเทศไทย</option>
                        <option value="18">ธนาคารแห่งประเทศจีน</option>
                        <option value="19">ธนาคาร มิตซุย ทรัสต์ (ไทย)</option>
                        <option value="20">ธนาคารฮ่องกงและเซี้ยงไฮ้แบงกิ้งคอร์ปอเรชั่น จำกัด</option>
                        <option value="21">ยูโอบี</option>
                        <option value="22">แลนด์ แอนด์ เฮาส์</option>
                        <option value="23">สแตนดาร์ดชาร์เตอร์ด (ไทย)</option>
                        <option value="24">ไอซีบีซี (ไทย)</option>
                        <option value="25">Promptpay</option>
                        <option value="26">TrueMoney Wallet</option>

                    </select>
                    <p style="text-align: start; color: #6E6E6E; margin-bottom: -1px;">เลขบัญชีธนาคาร</p>
                    <input type="text" class="form-control" name="bank_ac_num"
                        style="background-color: #E9E9E9; border-radius: 10px; border: none; height: 50px; margin-bottom: 15px;">
                    <!--  -->
                    <p style="text-align: start; color: #6E6E6E; margin-bottom: -1px;">บัตรประชาชน</p>
                    <!--  -->
                    <div class="file-upload-container">
                        <label for="file-upload" class="file-upload-label">
                            <!-- <div class="file-upload-box"> -->
                            <input id="file-upload" type="file" name="id_img" accept="image/*">
                        </label>
                        <div class="preview-container" id="preview-container"></div>
                        <!-- <div class="plus-sign">+</div> -->
                    </div>
                </div>

                <button class="btn mt-3" type="submit"
                    style="background-color: #8472AC; color: white; width: 500px; height: 50px; 
                    font-size: 18px; font-weight: bold; border-radius: 30px;">Register</button>
            </form>
            <hr style="width: 600px;">
            <p class="account" style="color: #AAAAAA; font-weight: bold;">Already have an account? <a href="/login"
                    style="color: #4873E2;">Login</a></p>
        </center>

    </div>

</body>
<script>
    function toggleForm() {
        const customerForm = document.getElementById('customerForm');
        const sellerForm = document.getElementById('sellerForm');
        const customer = document.getElementById('customer');
        const seller = document.getElementById('seller');

        if (seller.checked) {
            sellerForm.style.display = 'block';
            return selectedRole = 2;

        } else {
            sellerForm.style.display = 'none';
            return selectedRole = 1;
        }
    }

    document.querySelector('#registerForm').onsubmit = async (e) => {
        e.preventDefault(); // Prevent the form from submitting the traditional way

        const form = e.target;
        const firstName = form['first_name'].value;
        const lastName = form['last_name'].value;
        const phonenum = form['phonenum'].value;
        const email = form['email'].value;
        const pass = form['password'].value;
        const confirmPass = form['confirm-pass'].value;
        const bankAcName = form['bank_ac_name'] ? form['bank_ac_name'].value : null;
        const bankAcNum = form['bank_ac_num'] ? form['bank_ac_num'].value : null;
        const idImg = form['id_img']?.files[0];

        let selectedRole;
        let status;

        if (document.getElementById('seller').checked) {
            selectedRole = 2;
            status = 2;
            if (firstName === '' || lastName === '' || phonenum === '' || email === '' || pass === '' || confirmPass === '' || bankAcName === '' || bankAcNum === '' || !idImg) {
                Swal.fire({
                    icon: 'error',
                    title: 'กรุณากรอกข้อมูลให้ครบถ้วน',
                });
                return;
            }
            if (pass !== confirmPass) {
                Swal.fire({
                    icon: 'error',
                    title: 'Passwords do not match',
                });
                return;
            }
        } else {
            selectedRole = 1;
            status = 1;
            if (firstName == '' || lastName == '' || phonenum == '' || email == '' || pass == '' || confirmPass == '') {
                Swal.fire({
                    icon: 'error',
                    title: 'กรุณากรอกข้อมูลให้ครบถ้วน',
                });
                return;
            }
            if (pass !== confirmPass) {
                Swal.fire({
                    icon: 'error',
                    title: 'Passwords do not match',
                });
                return;
            }
        }

        // Form is valid, create FormData to submit
        const formData = new FormData();
        formData.append('first_name', firstName);
        formData.append('last_name', lastName);
        formData.append('email', email);
        formData.append('password', pass);
        formData.append('phonenum', phonenum);
        formData.append('role', selectedRole);
        formData.append('bank_ac_name', bankAcName);
        formData.append('bank_ac_num', bankAcNum);
        formData.append('user_status', status);
        formData.append('id_img', idImg);


        try {
            const res = await fetch('/register', {
                method: 'POST',
                body: formData,
            });

            if (res.ok) {
                const data = await res.text();
                Swal.fire({
                title: "Register success!",
                text: "You have successfully registered!",
                icon: "success"
            }).then(() => {
                location.replace('/login');
            });
            } else if (res.status === 401) {
                const message = await res.text();
                alert(message);
            }
        } catch (err) {
            alert(err.message || 'An error occurred');
        }
    };

    document.getElementById('file-upload').addEventListener('change', previewImage);

    function previewImage(event) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function (e) {
            const previewContainer = document.getElementById('preview-container');
            previewContainer.style.textAlign = 'center'; // จัดกึ่งกลางเนื้อหาทั้งหมดในคอนเทนเนอร์
            previewContainer.innerHTML = `
            <img src="${e.target.result}" alt="Image Preview" style="width: 300px; height: auto; border-radius: 8px; margin-bottom: 10px; " />
            <button type="button" class="btn btn-danger" style="display: block; margin: 10px auto 0 auto;" onclick="removeImage()">Remove Image</button>
        `;
        };
        reader.readAsDataURL(file);
    }

    function removeImage() {
        document.getElementById('file-upload').value = '';
        document.getElementById('preview-container').innerHTML = '';
    }


</script>
<style>
    body {
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 0;
    }

    .container {
        margin: 50px;
        text-align: center;
        background-color: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    h1 {
        margin-bottom: 20px;
        font-weight: bold;
    }

    .toggle-switch {
        position: relative;
        width: 160px;
        height: 40px;
        background-color: #ddd;
        border-radius: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 5px;
    }

    .toggle-label {
        position: relative;
        width: 50%;
        text-align: center;
        cursor: pointer;
        z-index: 2;
        font-weight: bold;
        color: #000000;
        user-select: none;
    }

    .toggle-switch input[type="radio"] {
        display: none;
    }

    .toggle-switch input[type="radio"]:checked+.toggle-label {
        color: #000000;
    }

    .toggle-switch-button {
        position: absolute;
        width: 50%;
        height: 100%;
        background-color: #A1C9E2;
        border-radius: 20px;
        z-index: 1;
        transition: transform 0.3s ease;
    }

    #customer:checked~.toggle-switch-button {
        transform: translateX(0);
        background-color: #A1C9E2;
    }

    #seller:checked~.toggle-switch-button {
        transform: translateX(100%);
        background-color: #A1C9E2;
    }

    .photo {
        background-color: #d9d9d9;
        width: 320px;
        height: 200px;
        border-radius: 15px;

    }

    .file-upload-container {
        text-align: center;
        margin-bottom: 15px;
    }

    .file-upload-label {
        display: inline-block;
        text-align: left;
        cursor: pointer;
    }

    .file-upload-label span {
        display: block;
        margin-bottom: 8px;
        font-size: 14px;
        color: #555;
    }

    .file-upload-box {
        width: 300px;
        height: 150px;
        background-color: #e0e0e0;
        border-radius: 8px;
        display: flex;
        justify-content: center;
        align-items: center;
        position: relative;
    }

    .file-upload-box input[type="file"] {
        position: absolute;
        width: 100%;
        height: 100%;
        opacity: 0;
        cursor: pointer;
    }

    .plus-sign {
        font-size: 32px;
        color: #555;

    }
</style>

</html>